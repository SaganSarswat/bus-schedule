<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Laari ‚Äì Route Planner</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #eef6fb;
  }

  /* Header */
  .topbar {
    display: flex;
    align-items: center;
    padding: 14px;
    background: #ffffff;
    box-shadow: 0 1px 4px rgba(0,0,0,0.1);
  }

  .logo {
    background: #4aa0e0;
    border-radius: 10px;
    padding: 8px;
    margin-right: 8px;
  }

  .title {
    font-size: 22px;
    font-weight: bold;
    color: #4aa0e0;
  }

  /* Card */
  .card {
    background: white;
    margin: 15px;
    padding: 16px;
    border-radius: 14px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.08);
  }

  .card-header {
    display: flex;
    align-items: center;
    margin-bottom: 10px;
  }

  .card-header span {
    font-size: 22px;
    margin-right: 8px;
    color: #4aa0e0;
  }

  .card-header h2 {
    margin: 0;
    font-size: 22px;
  }

  .subtitle {
    color: #6b8ca6;
    font-size: 14px;
    margin-bottom: 14px;
  }

  label {
    font-size: 14px;
    font-weight: bold;
    display: block;
    margin-top: 12px;
    margin-bottom: 5px;
  }

  select {
    width: 100%;
    padding: 12px;
    border-radius: 10px;
    border: none;
    background: #eaf3ff;
    font-size: 15px;
  }

  /* Checkbox box */
  .checkbox-box {
    margin-top: 14px;
    padding: 14px;
    border-radius: 12px;
    border: 1px solid #cfe3f3;
    display: flex;
    gap: 10px;
  }

  .checkbox-box input {
    width: 20px;
    height: 20px;
    margin-top: 2px;
  }

  .checkbox-text {
    font-size: 14px;
  }

  .checkbox-text small {
    display: block;
    color: #6b8ca6;
    margin-top: 4px;
  }

  /* Button */
  .btn {
    margin-top: 16px;
    width: 100%;
    padding: 14px;
    background: #4aa0e0;
    color: white;
    border: none;
    border-radius: 12px;
    font-size: 16px;
    font-weight: bold;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 8px;
    cursor: pointer;
  }

  .result {
    margin-top: 10px;
    padding: 10px;
    border-radius: 10px;
    background: #f3faff;
    border: 1px solid #cfe3f3;
  }
</style>
</head>

<body>

<!-- Header -->
<div class="topbar">
  <div class="logo">
    <img src="bus-stop (1).png" alt="Bus" width="36" height="36">
  </div>
  <div class="title">Laari</div>
</div>

<!-- Route Planner Card -->
<div class="card">
  <div class="card-header">
    <span>üîÄ</span>
    <h2>Route Planner</h2>
  </div>

  <div class="subtitle">
    Find real-time bus ETAs for your journey.
  </div>

  <label>Current Location</label>
  <select id="from"></select>

  <label>Destination</label>
  <select id="to"></select>

  <div class="checkbox-box">
    <input type="checkbox" id="fullDay">
    <div class="checkbox-text">
      <strong>Show full day schedule</strong>
      <small>
        Check this to see all buses for the entire day.
      </small>
    </div>
  </div>

  <button class="btn" id="findBtn">
    üîç Find Departures
  </button>

  <div id="results"></div>
</div>

<!-- JavaScript -->
<script>
let busStops = {};
let routes = {};
let buses = {};

fetch("laari-data.json")
  .then(res => res.json())
  .then(data => {
    busStops = data.busStops;
    routes = data.routes;
    buses = data.buses;
    populateStops();
  });

function populateStops() {
  const from = document.getElementById("from");
  const to = document.getElementById("to");

  from.innerHTML = "<option value=''>Select current location</option>";
  to.innerHTML = "<option value=''>Select destination</option>";

  Object.entries(busStops).forEach(([id, stop]) => {
    from.innerHTML += `<option value="${id}">${stop.name}</option>`;
    to.innerHTML += `<option value="${id}">${stop.name}</option>`;
  });
}

document.getElementById("findBtn").addEventListener("click", () => {
  const from = document.getElementById("from").value;
  const to = document.getElementById("to").value;
  const fullDay = document.getElementById("fullDay").checked;
  const results = document.getElementById("results");

  results.innerHTML = "";

  if (!from || !to) {
    results.innerHTML = "Please select both locations.";
    return;
  }

  const routeEntry = Object.entries(routes).find(([_, r]) => {
    const a = r.stopIds.indexOf(from);
    const b = r.stopIds.indexOf(to);
    return a !== -1 && b !== -1 && a < b;
  });

  if (!routeEntry) {
    results.innerHTML = "No route found.";
    return;
  }

  const routeId = routeEntry[0];
  const now = new Date();
  const nowMinutes = now.getHours() * 60 + now.getMinutes();

  Object.values(buses)
    .filter(bus => bus.routeId === routeId)
    .filter(bus => {
      if (fullDay) return true;
      const [h, m] = bus.departureTime.split(":");
      return (+h * 60 + +m) >= nowMinutes;
    })
    .sort((a, b) => a.departureTime.localeCompare(b.departureTime))
    .forEach(bus => {
      results.innerHTML += `
        <div class="result">
          <strong>${bus.departureTime}</strong><br>
          Operator: ${bus.operator}
        </div>
      `;
    });
});
</script>

</body>
</html>